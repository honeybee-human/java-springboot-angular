<div class="diary-container">
  <!-- Tab Navigation -->
  <div class="tab-navigation">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'entries'"
      (click)="setActiveTab('entries')">
      ğŸ“– My Entries
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'search'"
      (click)="setActiveTab('search')">
      ğŸ” Search Entries
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'add'"
      (click)="setActiveTab('add'); showAddForm = true">
      âœï¸ New Entry
    </button>
  </div>

  <!-- Entries Tab -->
  <div *ngIf="activeTab === 'entries'" class="tab-content">
    <!-- Quick Search -->
    <div class="search-controls">
      <div class="search-fields">
        <div class="search-field">
          <label for="quickSearch">Quick Search:</label>
          <input 
            id="quickSearch"
            type="text" 
            placeholder="Search all entries..." 
            [(ngModel)]="searchQuery"
            (input)="onSearch()"
            (keyup.enter)="onSearch()"
            class="search-input">
        </div>
        
        <button class="search-btn" (click)="onSearch()" [disabled]="loading">
          {{loading ? 'Searching...' : 'Search'}}
        </button>
      </div>
    </div>

    <!-- Entries List -->
    <div class="entries-section">
      <!-- Loading State -->
      <div *ngIf="loading" class="loading-state">
        <div class="loading-spinner"></div>
        <p>Loading entries...</p>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loading && entries.length === 0" class="empty-state">
        <div class="empty-icon">ğŸ“–</div>
        <h3>No entries found</h3>
        <p>Start writing your first diary entry or try different search terms.</p>
        <button class="cta-btn" (click)="setActiveTab('add'); showAddForm = true">
          âœï¸ Write First Entry
        </button>
      </div>

      <!-- Entries Grid -->
      <div *ngIf="!loading && entries.length > 0" class="entries-grid">
        <div *ngIf="loading" class="loading">Loading entries...</div>
        <div *ngIf="!loading && entries.length === 0" class="no-entries">
          <p>No diary entries yet. Start writing your first entry!</p>
        </div>
        
        <div *ngFor="let entry of entries" class="entry-card">
          <div class="entry-header">
            <h3 class="entry-title">{{entry.title}}</h3>
            <div class="entry-mood">
              <span class="mood-display">
                {{getMoodDisplay(entry.mood).emoji}} {{getMoodDisplay(entry.mood).description}}
              </span>
            </div>
          </div>
          
          <!-- Associated Book Display -->
          <div *ngIf="entry.associatedBook" class="entry-book">
            <div class="book-reference">
              <img [src]="entry.associatedBook.thumbnail || 'https://via.placeholder.com/40x60'" 
                   [alt]="entry.associatedBook.title" class="entry-book-thumbnail">
              <div class="entry-book-info">
                <span class="entry-book-title">ğŸ“š {{entry.associatedBook.title}}</span>
                <span *ngIf="entry.associatedBook.authors" class="entry-book-author">
                  by {{entry.associatedBook.authors.join(', ')}}
                </span>
              </div>
            </div>
          </div>
          
          <div class="entry-meta">
            <span class="entry-date">{{formatDate(entry.createdAt)}}</span>
            <div class="entry-tags">
              <span *ngFor="let tag of entry.tags" class="tag">{{tag}}</span>
            </div>
          </div>
          
          <div class="entry-content">
            <p>{{entry.content}}</p>
          </div>
          
          <div class="entry-actions">
            <button class="edit-btn" (click)="editEntry(entry)">âœï¸ Edit</button>
            <button class="delete-btn" (click)="deleteEntry(entry.id!)">
              ğŸ—‘ï¸ Delete
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Search Tab -->
  <div *ngIf="activeTab === 'search'" class="tab-content">
    <!-- Advanced Search Controls -->
    <div class="search-controls">
      <div class="search-fields">
        <!-- Title Search -->
        <div class="search-field">
          <label for="titleSearch">Search by Title:</label>
          <input 
            id="titleSearch"
            type="text" 
            placeholder="Search entry titles..." 
            [(ngModel)]="titleSearchQuery"
            (input)="onAdvancedSearch()"
            (keyup.enter)="onAdvancedSearch()"
            class="search-input">
        </div>
        
        <!-- Content Search -->
        <div class="search-field">
          <label for="textSearch">Search by Content:</label>
          <input 
            id="textSearch"
            type="text" 
            placeholder="Search entry content..." 
            [(ngModel)]="textSearchQuery"
            (input)="onAdvancedSearch()"
            (keyup.enter)="onAdvancedSearch()"
            class="search-input">
        </div>
        
        <!-- Mood Filter -->
        <div class="search-field">
          <label for="moodFilter">Filter by Mood:</label>
          <select id="moodFilter" [(ngModel)]="filterMood" (change)="onAdvancedSearch()" class="search-input">
            <option [value]="null">All Moods</option>
            <option *ngFor="let mood of moods" [value]="mood">
              {{getMoodDisplay(mood).emoji}} {{getMoodDisplay(mood).description}}
            </option>
          </select>
        </div>
        
        <button class="search-btn" (click)="onAdvancedSearch()" [disabled]="loading">
          {{loading ? 'Searching...' : 'Advanced Search'}}
        </button>
      </div>
    </div>

    <!-- Search Results -->
    <div class="search-results">
      <!-- Loading State -->
      <div *ngIf="loading" class="loading-state">
        <div class="loading-spinner"></div>
        <p>Searching entries...</p>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loading && entries.length === 0" class="empty-state">
        <div class="empty-icon">ğŸ”</div>
        <h3>No entries found</h3>
        <p>Try different search terms or check your filters.</p>
      </div>

      <!-- Results Grid -->
      <div *ngIf="!loading && entries.length > 0" class="entries-grid">
        <div *ngIf="loading" class="loading">Loading entries...</div>
        <div *ngIf="!loading && entries.length === 0" class="no-entries">
          <p>No diary entries yet. Start writing your first entry!</p>
        </div>
        
        <div *ngFor="let entry of entries" class="entry-card">
          <div class="entry-header">
            <h3 class="entry-title">{{entry.title}}</h3>
            <div class="entry-mood">
              <span class="mood-display">
                {{getMoodDisplay(entry.mood).emoji}} {{getMoodDisplay(entry.mood).description}}
              </span>
            </div>
          </div>
          
          <!-- Associated Book Display -->
          <div *ngIf="entry.associatedBook" class="entry-book">
            <div class="book-reference">
              <img [src]="entry.associatedBook.thumbnail || 'https://via.placeholder.com/40x60'" 
                   [alt]="entry.associatedBook.title" class="entry-book-thumbnail">
              <div class="entry-book-info">
                <span class="entry-book-title">ğŸ“š {{entry.associatedBook.title}}</span>
                <span *ngIf="entry.associatedBook.authors" class="entry-book-author">
                  by {{entry.associatedBook.authors.join(', ')}}
                </span>
              </div>
            </div>
          </div>
          
          <div class="entry-meta">
            <span class="entry-date">{{formatDate(entry.createdAt)}}</span>
            <div class="entry-tags">
              <span *ngFor="let tag of entry.tags" class="tag">{{tag}}</span>
            </div>
          </div>
          
          <div class="entry-content">
            <p>{{entry.content}}</p>
          </div>
          
          <div class="entry-actions">
            <button class="edit-btn" (click)="editEntry(entry)">âœï¸ Edit</button>
            <button class="delete-btn" (click)="deleteEntry(entry.id!)">
              ğŸ—‘ï¸ Delete
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Add/Edit Form Tab -->
  <div *ngIf="(activeTab === 'add' && showAddForm) || editingEntry" class="tab-content">
    <h3>{{editingEntry ? 'Edit Entry' : 'New Diary Entry'}}</h3>
    <form (ngSubmit)="saveEntry()" #entryForm="ngForm">
      <div class="form-group">
        <label for="title">Title</label>
        <input 
          type="text" 
          id="title"
          [(ngModel)]="currentEntry.title" 
          name="title"
          required
          class="form-control">
      </div>
      
      <div class="form-group">
        <label for="mood">How are you feeling?</label>
        <div class="mood-selector">
          <div 
            *ngFor="let mood of moods" 
            class="mood-option"
            [class.selected]="currentEntry.mood === mood"
            (click)="currentEntry.mood = mood">
            <span class="mood-emoji">{{getMoodDisplay(mood).emoji}}</span>
            <span class="mood-label">{{getMoodDisplay(mood).description}}</span>
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label for="content">Content</label>
        <textarea 
          id="content"
          [(ngModel)]="currentEntry.content" 
          name="content"
          required
          rows="6"
          class="form-control"
          placeholder="Write about your day..."></textarea>
      </div>
      
      <!-- Book Selection Section -->
      <div class="form-group">
        <label>Associated Book (Optional)</label>
        
        <!-- Selected Book Display -->
        <div *ngIf="currentEntry.associatedBook" class="selected-book">
          <div class="book-info">
            <img [src]="currentEntry.associatedBook.thumbnail || 'https://via.placeholder.com/60x90'" 
                 [alt]="currentEntry.associatedBook.title" class="book-thumbnail">
            <div class="book-details">
              <h4>{{currentEntry.associatedBook.title}}</h4>
              <p *ngIf="currentEntry.associatedBook.authors">{{getAuthorDisplay(currentEntry.associatedBook.authors)}}</p>
              <p *ngIf="currentEntry.associatedBook.description" class="book-description">
                {{truncateDescription(currentEntry.associatedBook.description, 250)}}
              </p>
            </div>
            <button type="button" class="remove-book-btn" (click)="removeSelectedBook()">
              âœ•
            </button>
          </div>
        </div>

        <!-- Book Search Modal Trigger -->
        <div class="book-search-controls">
          <button type="button" class="search-books-btn" (click)="openBookModal()">
            ğŸ“š {{currentEntry.associatedBook ? 'Change' : 'Select'}} Book
          </button>
        </div>
      </div>
      
      <div class="form-group">
        <label for="tags">Tags (comma separated)</label>
        <input 
          type="text" 
          id="tags"
          [(ngModel)]="tagsString" 
          name="tags"
          class="form-control"
          placeholder="work, family, travel">
      </div>
      
      <div class="form-actions">
        <button type="submit" class="save-btn" [disabled]="!entryForm.valid">
          {{editingEntry ? 'Update' : 'Save'}} Entry
        </button>
        <button type="button" class="cancel-btn" (click)="cancelEdit()">
          Cancel
        </button>
      </div>
    </form>
  </div>
</div>