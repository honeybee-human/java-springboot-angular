<div class="book-container">
  <div class="tab-navigation">
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'search'"
      (click)="setActiveTab('search')">
      🔍 Search Books
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'collection'"
      (click)="setActiveTab('collection')">
      📚 My Collection ({{savedBooks.length}})
    </button>
    <button 
      class="tab-btn" 
      [class.active]="activeTab === 'practice'"
      (click)="setActiveTab('practice')">
      🌟 Practice Books
    </button>
  </div>

  <div *ngIf="activeTab === 'search'" class="tab-content">
    <div class="search-controls modern-search">

      
      <div class="search-fields-container">
        <div class="search-row">
          <div class="search-field">
            <label for="titleSearch">Search by Title:</label>
            <input 
              id="titleSearch"
              type="text" 
              placeholder="Search by book title..." 
              [(ngModel)]="titleQuery"
              (keyup.enter)="searchBooks()"
              class="form-control">
          </div>
          
          <div class="search-field">
            <label for="authorSearch">Search by Author:</label>
            <input 
              id="authorSearch"
              type="text" 
              placeholder="Search by author name..." 
              [(ngModel)]="authorQuery"
              (keyup.enter)="searchBooks()"
              class="form-control">
          </div>
        </div>
        
        <div class="search-row">
          <div class="search-field full-width">
            <label for="descriptionSearch">Search by Description:</label>
            <input 
              id="descriptionSearch"
              type="text" 
              placeholder="Search in book descriptions..." 
              [(ngModel)]="descriptionQuery"
              (keyup.enter)="searchBooks()"
              class="form-control">
          </div>
          <div class="search-field books-per-page">
            <label for="pageSize">Books per page:</label>
            <select id="pageSize" [(ngModel)]="pageSize" (change)="onPageSizeChange()" class="form-control compact">
              <option [value]="8">8</option>
              <option [value]="16">16</option>
              <option [value]="24">24</option>
              <option [value]="40">40</option>
            </select>
          </div>
          

        </div>
                  <div class="search-action">
            <button class="btn btn-primary search-btn" (click)="searchBooks()" [disabled]="isSearching">
              {{isSearching ? '🔍 Searching...' : '🔍 Search'}}
            </button>
          </div>
      </div>
    </div>

    <div class="search-results">
      <div *ngIf="isSearching" class="loading-state">
        <div class="loading-spinner"></div>
        <p>Searching for books...</p>
      </div>

      <div *ngIf="!isSearching && hasSearched && searchResults.length === 0" class="empty-state">
        <div class="empty-icon">📚</div>
        <h3>No books found</h3>
        <p>Try different search terms or browse our popular books.</p>
      </div>

      <div *ngIf="!isSearching && searchResults.length > 0" class="books-grid">
        <div *ngFor="let book of displayedSearchResults" class="book-card">
          <div class="book-image">
            <img [src]="book.thumbnail || getPlaceholderImage()" [alt]="book.title" loading="lazy">
          </div>
          <div class="book-details">
            <h3 class="book-title">{{book.title}}</h3>
            <p class="book-subtitle" *ngIf="book.subtitle">{{book.subtitle}}</p>
            <p class="book-authors" *ngIf="book.authors?.length">
              {{getAuthorDisplay(book.authors)}}
            </p>
            <p class="book-description" *ngIf="book.description">
              {{truncateDescription(book.description, 250)}}
            </p>
            
            <div class="book-actions">
              <button 
                *ngIf="!book.isSaved" 
                class="save-btn" 
                (click)="saveBook(book)">
                💾 Save
              </button>
              <button 
                *ngIf="book.isSaved" 
                class="saved-btn" 
                disabled>
                ✅ Saved
              </button>
              <a 
                *ngIf="book.previewLink" 
                [href]="book.previewLink" 
                target="_blank" 
                class="preview-btn">
                👁️ Preview
              </a>
            </div>
          </div>
        </div>
      </div>

      <div *ngIf="!isSearching && searchResults.length > 0 && totalPages > 1" class="pagination">
        <div class="pagination-info">
          Showing {{((currentPage - 1) * pageSize) + 1}}-{{Math.min(currentPage * pageSize, totalResults)}} of {{totalResults}} results ({{pageSize}} per page)
        </div>
        
        <div class="pagination-controls">
          <button 
            class="page-btn" 
            [disabled]="currentPage === 1 || isSearching"
            (click)="goToPreviousPage()">
            ← Previous
          </button>
          
          <button 
            *ngFor="let page of visiblePages" 
            class="page-btn" 
            [class.active]="page === currentPage"
            [disabled]="isSearching"
            (click)="goToPage(page)">
            {{page}}
          </button>
          
          <span *ngIf="totalPages > 5 && visiblePages[visiblePages.length - 1] < totalPages" class="ellipsis">
            ...
          </span>
          
          <button 
            *ngIf="totalPages > 5 && visiblePages[visiblePages.length - 1] < totalPages" 
            class="page-btn" 
            [disabled]="isSearching"
            (click)="goToPage(totalPages)">
            {{totalPages}}
          </button>
          
          <button 
            class="page-btn" 
            [disabled]="currentPage === totalPages || isSearching"
            (click)="goToNextPage()">
            Next →
          </button>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="activeTab === 'collection'" class="tab-content">
   

    <div *ngIf="isLoadingCollection" class="loading-state">
      <div class="loading-spinner"></div>
      <p>Loading your collection...</p>
    </div>

    <div *ngIf="!isLoadingCollection && savedBooks.length === 0" class="empty-state">
      <div class="empty-icon">📚</div>
      <h3>Your collection is empty</h3>
      <p>Start building your library by saving books from the search tab.</p>
      <button class="cta-btn" (click)="setActiveTab('search')">
        🔍 Browse Books
      </button>
    </div>

    <div *ngIf="!isLoadingCollection && savedBooks.length > 0" class="books-grid">
      <div *ngFor="let book of savedBooks" class="book-card">
        <div class="book-image">
          <img [src]="book.thumbnail || getPlaceholderImage()" [alt]="book.title" loading="lazy">
        </div>
        <div class="book-details">
          <h3 class="book-title">{{book.title}}</h3>
          <p class="book-subtitle" *ngIf="book.subtitle">{{book.subtitle}}</p>
          <p class="book-authors" *ngIf="book.authors?.length">
            {{getAuthorDisplay(book.authors)}}
          </p>
          <p class="book-description" *ngIf="book.description">
            {{truncateDescription(book.description, 250)}}
          </p>
          
          <div class="book-actions">
            <button class="remove-btn" (click)="removeFromCollection(book.googleBooksId)">
              🗑️ Remove
            </button>
            <a 
              *ngIf="book.previewLink" 
              [href]="book.previewLink" 
              target="_blank" 
              class="preview-btn">
              👁️ Preview
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div *ngIf="activeTab === 'practice'" class="tab-content">

    <div class="books-grid">
      <div *ngFor="let book of fakeBooks" class="book-card">
        <div class="book-image">
          <img [src]="book.thumbnail || getPlaceholderImage()" [alt]="book.title" loading="lazy">
        </div>
        <div class="book-details">
          <h3 class="book-title">{{book.title}}</h3>
          <p class="book-subtitle" *ngIf="book.subtitle">{{book.subtitle}}</p>
          <p class="book-authors" *ngIf="book.authors?.length">
            {{getAuthorDisplay(book.authors)}}
          </p>
          <p class="book-description" *ngIf="book.description">
            {{truncateDescription(book.description, 250)}}
          </p>
          
          <div class="book-actions">
            <button 
              *ngIf="!checkSavedStatus(book)" 
              class="save-btn" 
              (click)="saveFakeBook(book)">
              💾 Save
            </button>
            <button 
              *ngIf="checkSavedStatus(book)" 
              class="saved-btn" 
              disabled>
              ✅ Saved
            </button>
            <a 
              *ngIf="book.previewLink" 
              [href]="book.previewLink" 
              target="_blank" 
              class="preview-btn">
              👁️ Preview
            </a>
          </div>
        </div>
      </div>
    </div>
  </div>

<div *ngIf="showSuccessMessage" class="snackbar success-snackbar" [class.show]="showSuccessMessage">
  <div class="snackbar-content">
    <span class="snackbar-icon">⭐</span>
    <span class="snackbar-message">{{successMessage}}</span>
  </div>
</div>